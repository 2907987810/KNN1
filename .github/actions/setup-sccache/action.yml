name: Setup sccache
inputs:
  extra-cache-key:
    required: false
    default: ''
runs:
  using: composite
  steps:
    - name: Get Date
      id: get-date
      run: echo "::set-output name=today::$(/bin/date -u '+%Y%m%d')"
      shell: bash

    - name: Fix Windows temporary directory
      # On Windows, for some reason the default temporary directory provided to sccache
      # may become read-only at some point. Work around by having a private tempdir.
      id: mktemp
      run: echo "::set-output name=tmpdir::$(cygpath -w $(mktemp -d))"
      shell: bash
      if: ${{ runner.os == 'Windows' }}

    - name: Setup sccache
      uses: hendrikmuhs/ccache-action@v1.2
      with:
        variant: sccache
        key: ${{ runner.os }}--${{ runner.arch }}--${{ github.workflow }}--${{ steps.get-date.outputs.today }}--${{ inputs.extra-cache-key }}
      env:
        TMP: "${{ steps.mktemp.outputs.tmpdir }}"
