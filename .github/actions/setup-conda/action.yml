name: Set up Conda environment
inputs:
  environment-file:
    description: Conda environment file to use.
    default: environment.yml
  environment-name:
    description: Name to use for the Conda environment
    default: test
  extra-specs:
    description: Extra packages to install
    required: false
  python-version:
    description: Python version to generate an environment file for
    required: false
  pyarrow-version:
    description: If set, overrides the PyArrow version in the Conda environment to the given string.
    required: false
runs:
  using: composite
  steps:
    - name: Generate ${{ inputs.environment-file }}
      shell: bash -el {0}
      run: |
        if [ ! -f "${{ inputs.environment-file }}" ]; then
          python ci/generate_ci_env.py ci/env-templates/base.yaml ${{ inputs.environment-file }} --python_version ${{ inputs.python-version }} --pyarrow_version ${{ inputs.pyarrow-version }}
        fi
    - name: Install ${{ inputs.environment-file }}
      uses: mamba-org/provision-with-micromamba@v12
      with:
        environment-file: ${{ inputs.environment-file }}
        environment-name: ${{ inputs.environment-name }}
        extra-specs: ${{ inputs.extra-specs }}
        channels: conda-forge
        channel-priority: ${{ runner.os == 'macOS' && 'flexible' || 'strict' }}
        condarc-file: ci/condarc.yml
        cache-env: true
        cache-downloads: true
