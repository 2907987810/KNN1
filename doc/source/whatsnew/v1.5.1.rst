.. _whatsnew_151:

What's new in 1.5.1 (October ??, 2022)
--------------------------------------

These are the changes in pandas 1.5.1. See :ref:`release` for a full changelog
including other versions of pandas.

{{ header }}

.. ---------------------------------------------------------------------------

.. _whatsnew_143.concat:

Behavior of ``groupby`` with categorical groupers (:issue:`48645`)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In versions of pandas prior to 1.5, ``groupby`` with ``dropna=False`` would still drop
NA values when the grouper was a categorical dtype. A fix for this was attempted in
1.5, however it introduced a regression where passing ``observed=False`` and
``dropna=False`` to ``groupby`` would result in only observed categories. It was found
that the patch fixing the ``dropna=False`` bug is incompatible with ``observed=False``,
and decided that the best resolution is to restore the correct ``observed=False``
behavior at the cost of reintroducing the ``dropna=False`` bug.

.. ipython:: python

   df = pd.DataFrame(
       {
           "x": pd.Categorical([1, None], categories=[1, 2, 3]),
           "y": [3, 4],
       }
   )
   df

*1.5.0 behavior*:

.. code-block:: ipython

   In [3]: # Correct behavior, NA values are not dropped
           df.groupby("x", observed=True, dropna=False).sum()
   Out[3]:
        y
   x
   1    3
   NaN  4


   In [4]: # Incorrect behavior, only observed categories present
           df.groupby("x", observed=False, dropna=False).sum()
   Out[4]:
        y
   x
   1    3
   NaN  4


*1.5.1 behavior*:

.. ipython:: python

   # Incorrect behavior, NA values are dropped
   df.groupby("x", observed=True, dropna=False).sum()

   # Correct behavior, unobserved categories present (NA values still dropped)
   df.groupby("x", observed=False, dropna=False).sum()

.. _whatsnew_151.regressions:

Fixed regressions
~~~~~~~~~~~~~~~~~
- Regression in :func:`.read_csv` causing an ``EmptyDataError`` when using an UTF-8 file handle that was already read from (:issue:`48646`)
-

.. ---------------------------------------------------------------------------

.. _whatsnew_151.bug_fixes:

Bug fixes
~~~~~~~~~
-
-

.. ---------------------------------------------------------------------------

.. _whatsnew_151.other:

Other
~~~~~
-
-

.. ---------------------------------------------------------------------------

.. _whatsnew_151.contributors:

Contributors
~~~~~~~~~~~~
